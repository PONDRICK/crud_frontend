<!-- edit-user.component.html -->
<div class="popup-form">
  <h2 class="text-xl font-semibold mb-4">Edit User</h2>

  <form [formGroup]="editUserForm" (ngSubmit)="submitForm()">
    <!-- User ID (read-only if you don't want it to be editable) -->
    <div>
      <label for="id" class="block mb-2">User ID *</label>
      <input
        formControlName="id"
        type="text"
        class="border p-2 w-full rounded"
        [readonly]="true"
      />
    </div>

    <!-- First Name and Last Name -->
    <div class="flex space-x-4 mt-4">
      <div class="flex-1">
        <label for="firstName" class="block mb-2">First Name *</label>
        <input
          formControlName="firstName"
          type="text"
          class="border p-2 w-full rounded"
        />
        <div
          *ngIf="
            editUserForm.get('firstName')?.invalid &&
            editUserForm.get('firstName')?.touched
          "
          class="text-red-600"
        >
          First Name is required.
        </div>
      </div>
      <div class="flex-1">
        <label for="lastName" class="block mb-2">Last Name *</label>
        <input
          formControlName="lastName"
          type="text"
          class="border p-2 w-full rounded"
        />
        <div
          *ngIf="
            editUserForm.get('lastName')?.invalid &&
            editUserForm.get('lastName')?.touched
          "
          class="text-red-600"
        >
          Last Name is required.
        </div>
      </div>
    </div>

    <!-- Email, Mobile No, Select Role Type -->
    <div class="flex space-x-4 mt-4">
      <div class="flex-1">
        <label for="email" class="block mb-2">Email *</label>
        <input
          formControlName="email"
          type="email"
          class="border p-2 w-full rounded"
        />
        <div
          *ngIf="
            editUserForm.get('email')?.hasError('required') &&
            editUserForm.get('email')?.touched
          "
          class="text-red-600"
        >
          Email is required.
        </div>
        <div
          *ngIf="
            editUserForm.get('email')?.hasError('email') &&
            editUserForm.get('email')?.touched
          "
          class="text-red-600"
        >
          Please enter a valid email.
        </div>
        <div
          *ngIf="
            editUserForm.get('email')?.hasError('emailExists') &&
            editUserForm.get('email')?.touched
          "
          class="text-red-600"
        >
          This email is already in use.
        </div>
      </div>
      <div class="flex-1">
        <label for="phone" class="block mb-2">Mobile No</label>
        <input
          formControlName="phone"
          type="text"
          class="border p-2 w-full rounded"
        />
      </div>
      <div class="flex-1">
        <label for="roleId" class="block mb-2">Select Role Type *</label>
        <select formControlName="roleId" class="border p-2 w-full rounded">
          <option *ngFor="let role of roles" [value]="role.roleId">
            {{ role.roleName }}
          </option>
        </select>
        <div
          *ngIf="
            editUserForm.get('roleId')?.invalid &&
            editUserForm.get('roleId')?.touched
          "
          class="text-red-600"
        >
          Role Type is required.
        </div>
      </div>
    </div>

    <!-- Username, Password, Confirm Password -->
    <div class="flex space-x-4 mt-4">
      <div class="flex-1">
        <label for="username" class="block mb-2">Username *</label>
        <input
          formControlName="username"
          type="text"
          class="border p-2 w-full rounded"
        />
        <div
          *ngIf="
            editUserForm.get('username')?.invalid &&
            editUserForm.get('username')?.touched
          "
          class="text-red-600"
        >
          Username is required.
        </div>
      </div>
      <div class="flex-1">
        <label for="password" class="block mb-2">Password</label>
        <input
          formControlName="password"
          type="password"
          class="border p-2 w-full rounded"
          placeholder="Leave blank to keep current password"
        />
      </div>
      <div class="flex-1">
        <label for="confirmPassword" class="block mb-2">Confirm Password</label>
        <input
          formControlName="confirmPassword"
          type="password"
          class="border p-2 w-full rounded"
        />
        <div
          *ngIf="
            editUserForm.hasError('passwordMismatch') &&
            editUserForm.get('confirmPassword')?.touched
          "
          class="text-red-600"
        >
          Passwords do not match.
        </div>
      </div>
    </div>

    <!-- Module Permission -->
    <h3 class="text-lg font-semibold mt-6 mb-4">Module Permission</h3>
    <table class="min-w-full bg-white mb-6">
      <thead>
        <tr>
          <th class="py-2">Permission</th>
          <th class="py-2 text-center">Read</th>
          <th class="py-2 text-center">Write</th>
          <th class="py-2 text-center">Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let permissionControl of userPermissionsControls;
            let i = index
          "
          [formGroup]="permissionControl"
        >
          <td class="py-2">{{ permissions[i]?.permissionName }}</td>
          <td class="py-2 text-center">
            <input type="checkbox" formControlName="isReadable" />
          </td>
          <td class="py-2 text-center">
            <input type="checkbox" formControlName="isWritable" />
          </td>
          <td class="py-2 text-center">
            <input type="checkbox" formControlName="isDeletable" />
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Submit and Cancel buttons -->
    <div class="flex justify-end mt-6">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">
        Save Changes
      </button>
      <button
        type="button"
        class="bg-gray-500 text-white px-4 py-2 rounded ml-2"
        (click)="cancelForm()"
      >
        Cancel
      </button>
    </div>
  </form>
</div>
